<script>
  const video = document.getElementById('promoVideo');
  const slideshow = document.getElementById('slideshow-section');
  const slideImg = document.getElementById('slide-img');
  const videoSection = document.getElementById('video-section');

  let slideUrls = [], slideIndex = 0;

  async function fetchSlideImages() {
    const resp = await fetch('https://api.github.com/repos/skenderes/digital-sign/contents/media/slides');
    const data = await resp.json();
    slideUrls = data
      .filter(f => f.type === 'file' && /\.(jpe?g|png)$/i.test(f.name))
      .sort((a, b) => a.name.localeCompare(b.name))
      .map(f => f.download_url);
  }

  function startSlideshow() {
    videoSection.classList.add('hidden');
    slideshow.classList.remove('hidden');
    slideIndex = 0;
    showNextSlide();
  }

  function showNextSlide() {
    if (slideUrls.length === 0) {
      // No slides, fallback to video
      switchToVideo();
      return;
    }
    slideImg.src = slideUrls[slideIndex];
    slideIndex++;
    if (slideIndex < slideUrls.length) {
      setTimeout(showNextSlide, 5000); // Show next slide after 5 seconds
    } else {
      // Finished all slides, go back to video
      setTimeout(switchToVideo, 5000);
    }
  }

  function switchToVideo() {
    slideshow.classList.add('hidden');
    videoSection.classList.remove('hidden');
    video.currentTime = 0;
    video.play();
  }

  // When video ends, fetch slides and start slideshow
  video.addEventListener('ended', async () => {
    await fetchSlideImages();
    startSlideshow();
  });

  // Start video automatically on page load
  video.loop = false;
  video.play();
</script>
