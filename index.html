<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Digital Sign</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      height: 100%;
    }
    .section {
      position: absolute;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      display: none;
    }
    .visible {
      display: block;
    }
    video, iframe, img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border: none;
    }
    #sst-img {
      object-fit: contain;
      background: black;
    }
  </style>
</head>
<body>

  <!-- Video Section -->
  <div id="video-section" class="section visible">
    <video id="promoVideo" autoplay muted playsinline>
      <source src="https://raw.githubusercontent.com/skenderes/digital-sign/main/media/IUI_2023_intro_alpha_16x9_24fps.mp4" type="video/mp4">
    </video>
  </div>

  <!-- Google Slides Section -->
  <div id="slides-section" class="section">
    <iframe
      src="https://docs.google.com/presentation/d/e/2PACX-1vTr65TWJAKH-8sEuWBc46E4HrvnnDYGfk5szsxWjxlw_HVRvw7x-9RgKJlKayFzM2woNY3pG0RUoJqU/pub?start=true&loop=true&delayms=5000&rm=minimal"
      allowfullscreen
    ></iframe>
  </div>

  <!-- SST Animation Section -->
  <div id="sst-section" class="section">
    <img id="sst-img" src="" alt="SST Animation">
  </div>

  <script>
    const sections = [
      document.getElementById('video-section'),
      document.getElementById('slides-section'),
      document.getElementById('sst-section')
    ];
    const video = document.getElementById('promoVideo');
    const sstImg = document.getElementById('sst-img');

    // Function to rotate sections
    let currentIndex = 0;
    function showSection(index) {
      sections.forEach((sec, i) => {
        sec.classList.toggle('visible', i === index);
      });
    }

    // Build SST image URLs for last 7 days
    function getDateString(daysAgo) {
      const date = new Date();
      date.setUTCDate(date.getUTCDate() - daysAgo);
      const yyyy = date.getUTCFullYear();
      const mm = String(date.getUTCMonth() + 1).padStart(2, '0');
      const dd = String(date.getUTCDate()).padStart(2, '0');
      return `${yyyy}${mm}${dd}`;
    }

    const sstFrames = [];
    for (let i = 6; i >= 0; i--) {
      const dateStr = getDateString(i);
      const url = `https://www.ospo.noaa.gov/data/cb/ssta/daily/${dateStr.slice(0,4)}/ct5km_ssta_v3.1_global_${dateStr}.png`;
      sstFrames.push(url);
    }

    // Preload SST images
    sstFrames.forEach(url => {
      const img = new Image();
      img.src = url;
    });

    // Loop through SST frames
    let sstIndex = 0;
    function updateSSTFrame() {
      sstImg.src = sstFrames[sstIndex] + `?t=${Date.now()}`;
      sstIndex = (sstIndex + 1) % sstFrames.length;
    }

    // Animation control
    video.addEventListener('ended', () => {
      currentIndex = 1;
      showSection(currentIndex);
      setTimeout(() => {
        currentIndex = 2;
        showSection(currentIndex);
        let animationInterval = setInterval(updateSSTFrame, 1000);
        updateSSTFrame(); // start immediately

        setTimeout(() => {
          clearInterval(animationInterval);
          currentIndex = 0;
          showSection(currentIndex);
          video.currentTime = 0;
          video.play();
        }, sstFrames.length * 1000); // 1s per frame
      }, 15000); // Slides section duration
    });

    // Initial state
    video.loop = false;
  </script>

</body>
</html>
